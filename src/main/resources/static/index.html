<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Gest√£o de Institui√ß√µes - Dashboard Completo</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 20px;
        background-color: #f8f9fa;
      }
      header {
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }
      h1 {
        color: #007bff;
      }
      .container {
        display: flex;
        gap: 30px;
      }
      .section-box {
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #fff;
        margin-bottom: 20px;
      }
      /* ATUALIZADO: Cont√™ineres de topo do Dashboard agora lado a lado */
      #institution-dashboard-section .dashboard-top-container {
        display: flex;
        gap: 30px;
        margin-bottom: 20px;
      }
      /* NOVO: Container para Formul√°rios de Gest√£o */
      #institution-dashboard-section .dashboard-creation-container {
        display: flex;
        gap: 30px;
        margin-bottom: 20px;
      }
      #super-admin-section .container {
        flex-direction: row;
      }
      #institution-dashboard-section .container {
        /* Mantido para a lista de gestores/escolas */
        flex-direction: row;
      }
      #institution-login-section {
        max-width: 400px;
        margin: 0 auto;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input[type="text"],
      input[type="password"],
      textarea,
      input[type="number"],
      input[type="date"], /* NOVO: Adicionado tipo date */
      select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        box-sizing: border-box;
      }
      button {
        padding: 10px 15px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 5px;
      }
      button:hover {
        background-color: #218838;
      }
      .delete-btn {
        background-color: #dc3545;
      }
      .pdf-btn {
        background-color: #007bff;
      }
      .refresh-btn {
        background-color: #6c757d;
      }
      .comunicado-btn {
        background-color: #009688; /* Cor Verde-√Ågua para Comunicado */
      }
      .tarefa-btn {
        background-color: #ffa500; /* Cor Laranja para Tarefa */
      }
      .list-group {
        list-style: none;
        padding: 0;
      }
      .list-group-item {
        border: 1px solid #eee;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      #message {
        margin-top: 20px;
        padding: 10px;
        border-radius: 4px;
        display: none;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
      }
      .hidden {
        display: none;
      }
      .login-btn {
        background-color: #4caf50;
      }
      .gestor-info {
        font-size: 14px;
        color: #666;
      }
      .school-item {
        background-color: #f8f9fa;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 5px;
        border-left: 4px solid #007bff;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Gest√£o de Institui√ß√µes</h1>
      <p>
        Endpoint Base: <strong>http://localhost:8080/api/instituicoes</strong>
      </p>
      <p id="auth-status" style="font-weight: bold; color: red">
        üî¥ N√≠vel de Acesso: Super Admin (N√≠vel 1)
      </p>
      <button onclick="changeView('super-admin')" class="pdf-btn">
        Acesso Super Admin
      </button>
      <button onclick="changeView('institution-login')" class="login-btn">
        Acesso Institui√ß√£o (N√≠vel 2)
      </button>
      <button
        id="logout-btn"
        onclick="logoutInstitution()"
        class="delete-btn hidden"
      >
        Sair (Institui√ß√£o)
      </button>
    </header>

    <div id="message" class="hidden"></div>

    <section id="super-admin-section" class="section-box">
      <h2>Super Admin - Gest√£o de Institui√ß√µes Mestre</h2>
      <div class="container">
        <section style="flex: 1">
          <h3>Criar Institui√ß√£o</h3>
          <form id="form-criar">
            <div class="form-group">
              <label for="nome">Nome (Chave de Login):</label>
              <input type="text" id="nome" required />
            </div>
            <div class="form-group">
              <label for="cnpj">CNPJ:</label>
              <input type="text" id="cnpj" required />
            </div>
            <div class="form-group">
              <label for="inst-senha">Senha da Institui√ß√£o:</label>
              <input type="password" id="inst-senha" required />
            </div>
            <button type="submit">Criar Institui√ß√£o</button>
          </form>
        </section>

        <section style="flex: 1">
          <h3>Institui√ß√µes Cadastradas</h3>
          <button onclick="downloadReportPdf()" class="pdf-btn">
            Baixar Relat√≥rio (PDF)
          </button>
          <button onclick="fetchInstitutions()" class="refresh-btn">
            Recarregar Lista
          </button>
          <ul id="lista-instituicoes" class="list-group">
            <li>Carregando...</li>
          </ul>
        </section>
      </div>
    </section>

    <section id="institution-login-section" class="section-box hidden">
      <h2>üîë Login da Institui√ß√£o</h2>
      <form id="form-institution-login">
        <div class="form-group">
          <label for="login-login">Nome da Institui√ß√£o:</label>
          <input type="text" id="login-login" required />
        </div>
        <div class="form-group">
          <label for="login-senha">Senha:</label>
          <input type="password" id="login-senha" required />
        </div>
        <button type="submit" style="background-color: #007bff">Entrar</button>
      </form>
    </section>

    <section id="institution-dashboard-section" class="section-box hidden">
      <h2 id="dashboard-title">Dashboard - Institui√ß√£o: [Nome]</h2>
      <p style="color: blue; font-weight: bold">
        ID da Institui√ß√£o Logada: <span id="logged-institution-id"></span>
      </p>

      <div class="dashboard-creation-container">
        <section style="flex: 1">
          <h3>Cadastrar Novo Gestor üßë‚Äçüíº</h3>
          <form id="form-create-gestor">
            <div class="form-group">
              <label for="gestor-nome">Nome:</label>
              <input type="text" id="gestor-nome" required />
            </div>
            <div class="form-group">
              <label for="gestor-email">Email (Login):</label>
              <input type="text" id="gestor-email" required />
            </div>
            <div class="form-group">
              <label for="gestor-senha">Senha:</label>
              <input type="password" id="gestor-senha" required />
            </div>
            <button type="submit" style="background-color: #ff8c00">
              Cadastrar Gestor
            </button>
          </form>
        </section>

        <section style="flex: 1">
          <h3>Enviar Comunicado a Gestor ‚úâÔ∏è</h3>
          <form id="form-send-comunicado">
            <div class="form-group">
              <label for="comunicado-gestor">Gestor Destinat√°rio:</label>
              <select id="comunicado-gestor" required>
                <option value="">Carregando Gestores...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="comunicado-assunto">Assunto:</label>
              <input type="text" id="comunicado-assunto" required />
            </div>
            <div class="form-group">
              <label for="comunicado-corpo">Mensagem:</label>
              <textarea id="comunicado-corpo" rows="4" required></textarea>
            </div>
            <button type="submit" class="comunicado-btn">
              Enviar Comunicado
            </button>
          </form>
        </section>

        <section style="flex: 1">
          <h3>Criar Tarefa para Gestor üéØ</h3>
          <form id="form-create-tarefa">
            <div class="form-group">
              <label for="tarefa-gestor">Gestor Respons√°vel:</label>
              <select id="tarefa-gestor" required>
                <option value="">Carregando Gestores...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="tarefa-titulo">T√≠tulo:</label>
              <input type="text" id="tarefa-titulo" required />
            </div>
            <div class="form-group">
              <label for="tarefa-data-limite">Data Limite:</label>
              <input type="date" id="tarefa-data-limite" required />
            </div>
            <div class="form-group">
              <label for="tarefa-descricao">Descri√ß√£o:</label>
              <textarea id="tarefa-descricao" rows="3" required></textarea>
            </div>
            <button type="submit" class="tarefa-btn">Atribuir Tarefa</button>
          </form>
        </section>
      </div>
      <hr />

      <div class="dashboard-top-container">
        <section style="flex: 1">
          <h3>Cadastrar Nova Escola üè´</h3>
          <form id="form-add-school">
            <div class="form-group">
              <label for="school-nome">Nome da Escola:</label>
              <input type="text" id="school-nome" required />
            </div>
            <div class="form-group">
              <label for="school-gestor">Gestor Respons√°vel:</label>
              <select id="school-gestor" required>
                <option value="">Carregando Gestores...</option>
              </select>
              <small style="color: #666"
                >Se n√£o aparecer gestores, cadastre um primeiro</small
              >
            </div>
            <div class="form-group">
              <label for="school-cidade">Cidade:</label>
              <input type="text" id="school-cidade" required />
            </div>
            <div class="form-group">
              <label for="school-alunos">N√∫mero de Alunos:</label>
              <input
                type="number"
                id="school-alunos"
                min="0"
                value="0"
                required
              />
            </div>
            <button type="submit" style="background-color: #007bff">
              Cadastrar Escola
            </button>
          </form>
        </section>

        <section
          style="
            flex: 2;
            padding: 20px;
            border: 1px dashed #ccc;
            border-radius: 8px;
          "
        >
          <h4>Relat√≥rio de Status de Tarefas</h4>
          <button
            onclick="downloadTaskReportCsv()"
            class="pdf-btn"
            style="margin-bottom: 15px"
          >
            ‚¨áÔ∏è Baixar Relat√≥rio (PDF)
          </button>
          <p style="color: #666">
            Esta √°rea exibe as tarefas pendentes, conclu√≠das e atrasadas por
            Gestor, fazendo a requisi√ß√£o GET /api/tarefas (JSON) ou para
            download /api/tarefas/download-csv.
          </p>
        </section>
      </div>

      <hr />
      <h3>Gestores e Escolas Cadastradas</h3>
      <button
        onclick="fetchGestores(INSTITUICAO_LOGADA.id)"
        class="refresh-btn"
      >
        üîÑ Recarregar Gestores
      </button>
      <button onclick="fetchSchools(INSTITUICAO_LOGADA.id)" class="refresh-btn">
        üîÑ Recarregar Escolas
      </button>

      <div class="container" style="margin-top: 20px">
        <section style="flex: 1; border: 1px dashed #ccc; padding: 10px">
          <h4>üìã Lista de Gestores</h4>
          <div class="gestor-info">
            <strong>Total: <span id="total-gestores">0</span> gestores</strong>
          </div>
          <ul id="lista-gestores" class="list-group">
            <li>Nenhum gestor cadastrado.</li>
          </ul>
        </section>

        <section style="flex: 1; border: 1px dashed #ccc; padding: 10px">
          <h4>üè´ Lista de Escolas</h4>
          <div class="gestor-info">
            <strong>Total: <span id="total-escolas">0</span> escolas</strong>
          </div>
          <ul id="lista-escolas" class="list-group">
            <li>Nenhuma escola cadastrada.</li>
          </ul>
        </section>
      </div>
    </section>

    <script>
      // --- Vari√°veis Globais ---
      const API_URL = "http://localhost:8080/api/instituicoes";
      const AUTH_URL = "http://localhost:8080/api/auth";
      const TAREFA_API_URL = "http://localhost:8080/api/tarefas";

      let INSTITUICAO_LOGADA = null;

      // Elementos DOM
      const messageDiv = document.getElementById("message");
      const superAdminSection = document.getElementById("super-admin-section");
      const institutionLoginSection = document.getElementById(
        "institution-login-section"
      );
      const institutionDashboardSection = document.getElementById(
        "institution-dashboard-section"
      );
      const authStatusP = document.getElementById("auth-status");
      const logoutBtn = document.getElementById("logout-btn");
      const listaInstituicoes = document.getElementById("lista-instituicoes");
      const formCriar = document.getElementById("form-criar");
      const formInstitutionLogin = document.getElementById(
        "form-institution-login"
      );
      const formCreateGestor = document.getElementById("form-create-gestor");
      const formAddSchool = document.getElementById("form-add-school");
      const selectGestor = document.getElementById("school-gestor");
      const loggedInstitutionIdSpan = document.getElementById(
        "logged-institution-id"
      );
      const dashboardTitle = document.getElementById("dashboard-title");
      const listaGestores = document.getElementById("lista-gestores");
      const listaEscolas = document.getElementById("lista-escolas");
      const totalGestoresSpan = document.getElementById("total-gestores");
      const totalEscolasSpan = document.getElementById("total-escolas");
      const formSendComunicado = document.getElementById(
        "form-send-comunicado"
      );
      const selectComunicadoGestor =
        document.getElementById("comunicado-gestor");
      const formCreateTarefa = document.getElementById("form-create-tarefa");
      const selectTarefaGestor = document.getElementById("tarefa-gestor");

      // --- FUN√á√ïES DE UTENS√çLIOS E VISUALIZA√á√ÉO ---

      function showMessage(text, type) {
        messageDiv.textContent = text;
        messageDiv.className = type === "success" ? "success" : "error";
        messageDiv.classList.remove("hidden");
        setTimeout(() => {
          messageDiv.classList.add("hidden");
        }, 5000);
      }

      function changeView(view) {
        superAdminSection.classList.add("hidden");
        institutionLoginSection.classList.add("hidden");
        institutionDashboardSection.classList.add("hidden");
        logoutBtn.classList.add("hidden");

        if (view === "super-admin") {
          superAdminSection.classList.remove("hidden");
          authStatusP.innerHTML = "üî¥ N√≠vel de Acesso: Super Admin (N√≠vel 1)";
          fetchInstitutions();
        } else if (view === "institution-login") {
          institutionLoginSection.classList.remove("hidden");
          authStatusP.innerHTML =
            "üî¥ N√≠vel de Acesso: Institui√ß√£o (N√≠vel 2) - Fa√ßa Login";
        } else if (view === "institution-dashboard" && INSTITUICAO_LOGADA) {
          institutionDashboardSection.classList.remove("hidden");
          logoutBtn.classList.remove("hidden");
          dashboardTitle.textContent = `Dashboard - Institui√ß√£o: ${INSTITUICAO_LOGADA.nome}`;
          loggedInstitutionIdSpan.textContent = INSTITUICAO_LOGADA.id;
          authStatusP.innerHTML = `üü¢ N√≠vel de Acesso: Institui√ß√£o Logada - ${INSTITUICAO_LOGADA.nome}`;
          fetchGestores(INSTITUICAO_LOGADA.id);
          fetchSchools(INSTITUICAO_LOGADA.id);
        }
      }

      // --- 1. SUPER ADMIN (CRUD Institui√ß√µes) ---

      formCriar.addEventListener("submit", async (e) => {
        e.preventDefault();
        const nome = document.getElementById("nome").value;
        const cnpj = document.getElementById("cnpj").value;
        const senha = document.getElementById("inst-senha").value;

        const novaInstituicao = {
          nome: nome,
          cnpj: cnpj,
          senha: senha,
          escolas: [],
        };

        try {
          const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(novaInstituicao),
          });

          if (!response.ok) {
            const error = await response.text();
            throw new Error(
              `Falha ao criar: ${response.statusText}. Detalhe: ${error}`
            );
          }

          const data = await response.json();
          showMessage(
            `Institui√ß√£o "${data.nome}" criada com sucesso!`,
            "success"
          );
          formCriar.reset();
          fetchInstitutions();
        } catch (error) {
          showMessage(`Erro ao criar institui√ß√£o: ${error.message}`, "error");
        }
      });

      async function fetchInstitutions() {
        listaInstituicoes.innerHTML = "<li>Carregando...</li>";
        try {
          const response = await fetch(API_URL);
          const data = await response.json();
          listaInstituicoes.innerHTML = "";
          if (data.length === 0) {
            listaInstituicoes.innerHTML =
              "<li>Nenhuma institui√ß√£o cadastrada.</li>";
            return;
          }
          data.forEach((inst) => {
            const li = document.createElement("li");
            li.className = "list-group-item";
            li.innerHTML = `
                    <div>
                      <strong>${inst.nome}</strong> 
                      <small>| ID: ${inst.id}</small>
                    </div>
                    <div>
                      <button onclick="deleteInstitution('${inst.id}')" class="delete-btn">Deletar</button>
                    </div>
                  `;
            listaInstituicoes.appendChild(li);
          });
        } catch (error) {
          listaInstituicoes.innerHTML = `<li class="error">Falha ao conectar: ${error.message}.</li>`;
        }
      }

      async function deleteInstitution(id) {
        if (
          !window.confirm(
            `Tem certeza que deseja deletar a institui√ß√£o com ID ${id}?`
          )
        )
          return;
        try {
          const response = await fetch(`${API_URL}/${id}`, {
            method: "DELETE",
          });
          if (response.status === 204) {
            showMessage(`Institui√ß√£o ${id} deletada com sucesso!`, "success");
            fetchInstitutions();
          } else {
            throw new Error(`Status ${response.status} ao deletar.`);
          }
        } catch (error) {
          showMessage(`Erro ao deletar: ${error.message}`, "error");
        }
      }

      // --- FUN√á√ÉO ATUALIZADA COM CACHE BUSTER ---
      async function downloadReportPdf() {
        try {
          // Geramos um timestamp √∫nico para evitar que o navegador use o cache antigo
          const timestamp = new Date().getTime();
          const url = `${API_URL}/download/pdf?t=${timestamp}`;

          console.log("Baixando relat√≥rio de:", url);
          window.open(url, "_blank");
        } catch (error) {
          showMessage(`Erro ao iniciar download: ${error.message}`, "error");
        }
      }

      // --- FUN√á√ÉO PARA BAIXAR RELAT√ìRIO DE TAREFAS (PDF) ---
      async function downloadTaskReportCsv() {
        try {
          if (!INSTITUICAO_LOGADA) {
            showMessage("Fa√ßa login na institui√ß√£o primeiro.", "error");
            return;
          }

          // Adiciona timestamp para evitar cache
          const timestamp = new Date().getTime();

          // ‚úÖ CORRE√á√ÉO: Usar o endpoint de TAREFAS
          const url = `${TAREFA_API_URL}/download/pdf?instituicaoId=${INSTITUICAO_LOGADA.id}&t=${timestamp}`;

          console.log(
            "üì§ Baixando relat√≥rio de TAREFAS para institui√ß√£o:",
            INSTITUICAO_LOGADA.id
          );
          console.log("üåê URL:", url);

          // Abre em nova aba para download
          window.open(url, "_blank");

          showMessage(
            `Baixando relat√≥rio de TAREFAS da institui√ß√£o ${INSTITUICAO_LOGADA.nome}...`,
            "success"
          );
        } catch (error) {
          showMessage(`Erro ao baixar relat√≥rio: ${error.message}`, "error");
          console.error("Erro detalhado:", error);
        }
      }

      // --- 2. LOGIN DA INSTITUI√á√ÉO ---

      formInstitutionLogin.addEventListener("submit", async (e) => {
        e.preventDefault();
        const login = document.getElementById("login-login").value;
        const senha = document.getElementById("login-senha").value;

        try {
          const response = await fetch(`${AUTH_URL}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nome: login, senha: senha }),
          });

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(
              `Falha de Login: ${errorText || response.statusText}`
            );
          }

          INSTITUICAO_LOGADA = await response.json();
          showMessage(
            `Login bem-sucedido! Bem-vindo, ${INSTITUICAO_LOGADA.nome}.`,
            "success"
          );
          formInstitutionLogin.reset();
          changeView("institution-dashboard");
        } catch (error) {
          showMessage(`Erro: ${error.message}.`, "error");
        }
      });

      function logoutInstitution() {
        INSTITUICAO_LOGADA = null;
        showMessage("Deslogado com sucesso!", "success");
        changeView("institution-login");
      }

      // --- 3. DASHBOARD DA INSTITUI√á√ÉO ---

      formCreateGestor.addEventListener("submit", async (e) => {
        e.preventDefault();
        if (!INSTITUICAO_LOGADA)
          return showMessage("Fa√ßa login primeiro.", "error");

        const gestorData = {
          nome: document.getElementById("gestor-nome").value,
          email: document.getElementById("gestor-email").value,
          senha_hash: document.getElementById("gestor-senha").value,
        };

        try {
          const response = await fetch(
            `${API_URL}/${INSTITUICAO_LOGADA.id}/gestores`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(gestorData),
            }
          );

          if (!response.ok) throw new Error("Falha ao criar Gestor.");
          const data = await response.json();
          showMessage(`Gestor "${data.nome}" criado com sucesso!`, "success");
          formCreateGestor.reset();
          fetchGestores(INSTITUICAO_LOGADA.id);
        } catch (error) {
          showMessage(`Erro ao criar gestor: ${error.message}`, "error");
        }
      });

      async function fetchGestores(instituicaoId) {
        try {
          const response = await fetch(`${API_URL}/${instituicaoId}/gestores`);
          const gestores = await response.json();
          totalGestoresSpan.textContent = gestores.length;
          listaGestores.innerHTML = "";

          // Popular Selects
          const options =
            '<option value="">Selecione o gestor...</option>' +
            gestores
              .map(
                (g) => `<option value="${g.id}">${g.nome} (${g.email})</option>`
              )
              .join("");

          selectGestor.innerHTML = options;
          selectComunicadoGestor.innerHTML = options;
          selectTarefaGestor.innerHTML = options;

          gestores.forEach((g) => {
            const li = document.createElement("li");
            li.className = "list-group-item";
            li.innerHTML = `<div><strong>${g.nome}</strong><br><small>üìß ${g.email}</small></div>
                            <button onclick="deleteGestor('${instituicaoId}', '${g.id}')" class="delete-btn">Deletar</button>`;
            listaGestores.appendChild(li);
          });
        } catch (error) {
          listaGestores.innerHTML = "<li>Erro ao carregar gestores.</li>";
        }
      }

      // --- NOVA IMPLEMENTA√á√ÉO: Criar Tarefa ---
      formCreateTarefa.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!INSTITUICAO_LOGADA) {
          showMessage("Fa√ßa login na institui√ß√£o primeiro.", "error");
          return;
        }

        const tarefaData = {
          titulo: document.getElementById("tarefa-titulo").value,
          descricao: document.getElementById("tarefa-descricao").value,
          dataLimite: document.getElementById("tarefa-data-limite").value,
          gestorId: selectTarefaGestor.value,
          instituicaoId: INSTITUICAO_LOGADA.id,
        };

        // Valida√ß√£o simples
        if (
          !tarefaData.titulo ||
          !tarefaData.descricao ||
          !tarefaData.dataLimite ||
          !tarefaData.gestorId
        ) {
          showMessage("Preencha todos os campos obrigat√≥rios.", "error");
          return;
        }

        try {
          const response = await fetch(TAREFA_API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(tarefaData),
          });

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Falha ao criar tarefa: ${errorText}`);
          }

          const data = await response.json();
          showMessage(`Tarefa "${data.titulo}" criada com sucesso!`, "success");
          formCreateTarefa.reset();
        } catch (error) {
          showMessage(`Erro ao criar tarefa: ${error.message}`, "error");
          console.error("Erro detalhado:", error);
        }
      });

      async function fetchSchools(instituicaoId) {
        try {
          const response = await fetch(`${API_URL}/${instituicaoId}/escolas`);
          const escolas = await response.json();
          totalEscolasSpan.textContent = escolas.length;
          listaEscolas.innerHTML = "";
          escolas.forEach((e) => {
            const li = document.createElement("li");
            li.className = "school-item";
            li.innerHTML = `<strong>${e.nome}</strong><br><small>üìç ${e.cidade} | üë• ${e.numeroDeAlunos} alunos</small>`;
            listaEscolas.appendChild(li);
          });
        } catch (error) {
          listaEscolas.innerHTML = "<li>Erro ao carregar escolas.</li>";
        }
      }

      formAddSchool.addEventListener("submit", async (e) => {
        e.preventDefault();
        const gestorId = selectGestor.value;
        const escolaRequestDTO = {
          escola: {
            nome: document.getElementById("school-nome").value,
            cidade: document.getElementById("school-cidade").value,
            numeroDeAlunos: parseInt(
              document.getElementById("school-alunos").value
            ),
          },
          gestorId: gestorId,
        };

        try {
          const response = await fetch(
            `${API_URL}/${INSTITUICAO_LOGADA.id}/escolas`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(escolaRequestDTO),
            }
          );
          if (!response.ok) throw new Error("Erro ao cadastrar escola");
          showMessage("Escola cadastrada!", "success");
          formAddSchool.reset();
          fetchSchools(INSTITUICAO_LOGADA.id);
        } catch (error) {
          showMessage(error.message, "error");
        }
      });

      // Fun√ß√£o para deletar gestor (se necess√°rio)
      async function deleteGestor(instituicaoId, gestorId) {
        if (!window.confirm("Tem certeza que deseja deletar este gestor?"))
          return;
        try {
          const response = await fetch(
            `${API_URL}/${instituicaoId}/gestores/${gestorId}`,
            {
              method: "DELETE",
            }
          );
          if (response.status === 204) {
            showMessage("Gestor deletado com sucesso!", "success");
            fetchGestores(instituicaoId);
          } else {
            throw new Error(`Status ${response.status} ao deletar.`);
          }
        } catch (error) {
          showMessage(`Erro ao deletar gestor: ${error.message}`, "error");
        }
      }

      // Inicializa√ß√£o
      fetchInstitutions();
    </script>
  </body>
</html>
